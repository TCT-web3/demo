<!DOCTYPE html>

<head>
    <title>TCT Demo</title>
    <link href="/static/styles.css" rel="stylesheet" />

    <script>
        function loadTrace(fileName) {
            // Use fetch to send a request to the server
            var txHash = document.getElementById('tx-hash').value;
            var fileName = 'trace-' + txHash + '.txt';
            fetch('/display?file=' + fileName)
                .then(response => response.text())
                .then(data => {
                    // Insert the file content into the page
                    open('/display?file=' + fileName, 'trace')
                    // document.getElementById('fileContent').textContent = data;
                });
        }
    </script>
</head>

<body>
    <div class="entry-fields">
        <div class="entry-fields">
            <div class="form-container">
                <div class="input-box">
                    <input type="text" id="tx-hash" name="tx-hash" placeholder="Transaction hash...">
                </div>
                <div class="file-input">
                    <input id="upload" type="file" accept=".json" />
                </div>
                <div class="button-submit">
                    <button type="button" onclick="uploadFile()">Trace</button>
                </div>
            </div>
        </div>
    
    <div class="output-files">
        <button onclick="loadTrace()">Load Trace</button>
    
        <div id="fileContent"></div>
    </div>
        
        <script>
            function uploadFile() {
                var input = document.getElementById("upload");
                var file = input.files[0];

                var txHash = document.getElementById("tx-hash").value;

                if (file && txHash) {
                    if (file.type != "application/json") {
                        console.log("File is not a JSON file.");
                        return;
                    }

                    var formData = new FormData();
                    formData.append('file', file);
                    formData.append('tx-hash', txHash);

                    fetch('/trace', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => console.log(data))
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                } else {
                    console.log("No file selected or text field empty!");
                }
            }
        </script>
    </div>
</body>